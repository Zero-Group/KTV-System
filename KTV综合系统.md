#KTV综合系统
项目组成员： 	
                    15331170李忻恒
				  	15331148李晗
					15331162李善健
					15331143黎皓斌
					15331153李近朱
					15331156李可江


##第一章 需求分析
###1.1 问题陈述
####1.1.1概述
系统名称： ***KTV综合系统***
建立本系统的主要目的在于：
1）KTV商家可以快捷管理房间信息、顾客信息和服务员信息
2）顾客可以快捷续订房间、查询个人信息和点餐
####1.1.2系统整体需求概述
用户角色划分：
系统需将用户分为管理员，服务员，会员顾客，以及普通顾客。
####1.1.3系统功能需求概述
本系统主要有以下2个功能模块构成，分别为：
商家端：
**1）房间管理**
房间管理系统包括开房、查看房间使用信息，更改房间信息这几个功能，点击进入房间信息界面时，左边栏目展示各房间的使用情况。点击某房间，此时若该房间有人，则会显示该房间的房间使用信息，顾客信息，以及顾客的交易记录（如图1.1），此外，右下角有确认结账的选项。如果点击了代表没有人的房间的方格，则会直接进入更改房间信息界面，从而能设定开房初始时间和使用该房间的用户id。（如图1.2）
![此处输入图片的描述][1]
图1.1 查看房间信息

![此处输入图片的描述][2]
图1.2 新开房间


**2）会员管理**
会员管理包括会员注册，会员信息管理。会员注册界面（如图1.3）要求设定会员账号，会员密码，会员电话。点击注册，若符合商家设定的注册要求，则将该新注册的会员信息添加到会员数据库中。
会员信息管理界面包括选择会员界面，查看会员信息界面，以及更改会员信息界面。选择会员界面里使用列表来显示一个个会员名，也可以使用搜索栏直接搜索需要查看的会员名，并将符合条件的会员信息呈现在列表上。点击代表该会员的方格，则进入查看会员信息界面，该界面显示会员的会员账号，手机号，交易记录等具体信息。右下角有更改会员信息这一按钮，点击它便进入更改会员信息界面，该界面可更改会员手机号，会员名等各项信息，也包含删除会员的功能。

![此处输入图片的描述][3]
图1.3 会员注册界面

**3）账目管理**
账目管理包含商品名字界面、商品信息界面和账目查询界面。
商品信息界面（如图1.4）左边栏目为商品名字界面，该界面按类排列各种商品标签。点击任一商品的标签，则进入商品信息界面，该界面显示商品的价格和销售量状况，商家可通过其更改商品的名字和价格以及该商品的库存。
![此处输入图片的描述][4]
图1.4 商品信息界面






账目查询界面（如图1.5），该界面面左边为所要查询账单的时间表，可筛选出要查询的账单的年月日信息。设定好所要查询的账单的时间信息后，右边栏目显示账单的具体财务信息，包括商品销售情况，且能将信息整合成可视化图表。


![此处输入图片的描述][5]
客户端：
**4）订单查询**
包括房间名字界面，订单信息界面和订单筛选界面。
房间名字界面左边栏目为房间名字界面，该界面按房间名排序。点击任一房间名标签，则进入订单信息界面。订单筛选界面按时间先后排序显示该房间在当日的所有时间段的订单标签，点击某一订单标签，则进入订单信息界面。订单信息界面显示该房间在这一时间段的所有消费记录，并将信息整合成可视化图表。
**5）消费模块**
消费模块包含代驾和点餐两项内容。
此模块的界面左边为点餐按钮，右边为代驾按钮，用户可以根据个人需要选择点餐服务和代驾服务。在用户选择完毕后，系统将该订单发送给商家端。在商家端处理完订单后，系统接收订单处理信息，提醒用户订单被接受或者被退回。
**6）编辑用户信息**
用户可以在编辑用户信息界面更改个人的用户信息（如账号、密码、电话号码）。
###1.2 用例析取

###1.3 用例规约
####1.3.1 查询房间信息用例归约

> 用例名称：	查询房间信息 角色：	商家 用例说明：	本用例描述前台管理员如何使用本系统查询房间信息 前置条件：	前台管理员已经登陆了系统
> 基本事件流：	1.本用例开始于前台管理员打开并登陆前台管理程序后，进入主界面的查询房间信息功能；
> 2.管理员点击查询房间信息按键后，系统在页面中显示当前所有房间的名称（编号）列表；
> 3.管理员点击房间列表的某一项后，进入该房间的详细信息页面；
> 4.页面中显示当前房间是否在使用中、房间的使用者、房间的消费情况（当前房间产生的所有订单的信息）；
> 5.查询完成后，点击“退出”返回到房间列表；
> 6.点击“退出”，返回系统主界面 备选事件流：	无 异常事件流：	无 后置条件：	无

活动图	

![此处输入图片的描述][6]
图1.3.1 查询房间信息活动图


----------


####1.3.2 管理账目用例归约
用例名称：	管理账目
角色：	商家
用例说明：	本用例描述商家如何查询一段时间内的账单
前置条件：	系统获取了数据库中的账务信息
基本事件流：	1.本用例开始于打开客户端并在主界面选择管理账目功能；
2.左边栏目显示索要查询账单的时间表，可以选择要查询的账单的年月日信息；
3.设定好查询账单的时间信息，点击确认；
4.右边栏目显示账单的具体财务信息，包括房间号、消费金额以及消费时间，并将信息整合成可视化图表；
5.查询完后点击返回，返回主界面。
备选事件流：	
异常事件流：	无
后置条件：	无
活动图	
![此处输入图片的描述][7]
图1.3.2 管理账目活动图


----------


####1.3.3 增加会员用例归约



> 用例名称：	增加会员 角色：	商家 用例说明：	本用例描述前台管理员如何使用该系统增加会员信息 前置条件：	无
> 基本事件流：	1.本用例开始于前台管理员进入主界面的增加会员功能；
> 2.管理员点击增加会员后，系统在页面显示输入框，等待管理员按要求输入“用户名”、“密码”、“电话”，并点击确认按钮； 一旦用户提交了所需信息：
> 3.如果系统判断输入正确，屏幕上弹出“注册成功”对话框；
> 4.如果系统判断输入错误，屏幕上弹出“注册失败”对话框，并返回主菜单。 备选事件流：	 异常事件流：	无 后置条件：	无

活动图	
![此处输入图片的描述][8]
图1.3.3 增加会员活动图


----------


####1.3.4 续订房间用例规约

> 用例名称：	续订房间 角色：	用户 用例说明：	本用例描述用户在用户端程序上如何使用续订房间功能
> 前置条件：	用户在主界面点记续订房间按钮，进入续订房间主界面 基本事件流：	1.本用例开始于用户打开客户端程序并在主界面选择续订房间功能；
> 2.用户点击续订房间按钮，系统在界面中显示当前房间到期时间，并等待用户输入续订时长并点记确认按钮；
> 3.用户提交所需信息，如果系统判断输入正确，系统显示订单详情，等待用户取消或者确认；
> 4.用户选择确认，则提交订单到商家端，并告知用户订单已完成，本用例成功并结束，返回主菜单；
> 5.如果系统判断输入错误，提示用户输入方式错误。 备选事件流：	用户取消续订房间，在续订房间主界面，若用户点击取消按钮，则系统返回主界面，本用例结束 异常事件流：	无
> 后置条件：	若用例成功，商家收到此用户订单并更改记录；否则，系统保持不变

活动图	
![此处输入图片的描述][9]
图1.3.4 续订房间活动图


----------


###1.4 补充规约
####1.4.1 目标
本文档的目的是定义KTV综合系统的需求。本补充规约列出了不便于在用例模型的用例中获取的系统需求。补充规约和用例模型一起记录关于系统的一整套需求。

####1.4.2 范围
本补充规约使用于《KTV综合系统平台》，本补充规约补充了该系统的功能性需求和非功能性需求，如可靠性、可用性、性能和可支持性等。

####1.4.3 参考
无

####1.4.4 功能
多个用户必须能同时执行操作。如果某个用户所点服务无法完成，必须通知该用户。

####1.4.5 可行性
桌面用户界面应与Windows 10系统界面兼容。

####1.4.6 可靠性
系统提供任何能够正常连接互联网的设备的访问权限。尽量保证24小时均能访问。

####1.4.7 性能
系统能在1秒钟内做出反应，并且支持多人同时访问。必须能够在2分钟内处理所有订单的80%。

####1.4.8 可支持性
无。

####1.4.9 安全性
只有管理员能进入账目系统，发布、更新、删除商品。只有管理员登入服务员管理界面，进行服务员管理。

####1.4.10 设计约束
使用MySQL数据库。


----------


###1.5术语表

> **KTV综合系统** 一个用于KTV综合管理的系统，包括商家端和用户端
> **商家端**	 运行在KTV商家电脑上的KTV管理系统，包括房间管理、商品管理、会员信息管理等功能
> **房间信息** KTV房间的使用情况，包括房间号、房间类别、使用者、剩余消费时间等信息
> **商品信息** KTV中售卖的各种食物以及酒水饮料的信息，包括该物品的名称、价格、库存量等
> **会员信息** 在KTV中办理会员的用户的相关信息，包括用户名、密码、手机号等
> **账目** KTV商家的账目记录，包括所有的消费记录、消费类别以及消费金额
> **用户端** 运行在KTV点歌台上的KTV用户服务系统，包括点餐、代驾、呼叫服务员等功能
> **点餐** 在KTV进行消费时，可以购买该KTV提供的各种食物以及酒水饮料
> **代驾** 若用户在KTV内饮酒，不方便驾驶车辆，可以联系KTV的专业驾驶人员驾驶车主的车将其送至指定地点并收取一定费用
> **房间续订** 增加房间的可消费时长，并支付相应的金额
> **管理员** 一般为KTV前台服务员，负责房间管理和安排服务，并拥有管理注册用户信息权限
> **普通用户**	 在KTV进行消费的客人
> **会员**	 在KTV进行消费，并且在KTV注册了会员的客人
> **用户名** 注册会员时，需要用户输入唯一的用户名，用于确认会员身份


----------


##第二章 架构设计
###2.1 架构设计
*本系统采用了MVC（Model-View-Controller）设计，模式，实现一个典型的三层架构模型。三层架构模型包括：模型层、视图层、控制器层。*
**1）视图层(View)**
视图层负责接收用户的命令，交给控制器层处理，并显示处理结果。我们采用C#负责视图层，并且调用控制器层提供的接口进行数据传递。
**2）控制器层(Control)**
是系统的核心组成部分。管理所有系统功能有关的数据流和控制流，从而实现系统的逻辑功能。向上提供服务接口给表示层调用。在控制器层中，不同的子系统提供独立的服务接口，各自独立实现，互不干预影响。控制器层依赖于持久化提供的持久化服务。
**3）模型层(Model)**
模型层包括数据实体，并向上提供接口。属于不同子系统的数据实体放置在不同的包中。
下面给出系统的总体架构图，总体架构如上述，为典型的三层架构。

![此处输入图片的描述][10]

图2.1 KTV综合系统架构图

###2.2关键抽象
关键抽象是概要设计的第一步，即将需求模型中的关键实体以及他们的关系识别并抽取出来，亦即领域模型。图 2.2 给出本系统的关键抽象。

![此处输入图片的描述][11]
图2.2 KTV系统关键抽象图


----------




##第三章 用例分析
###3.1 KTV系统的用例顺序图分析
本系统的用例较多，无法一一列举，故选取了用例房间管理中的子用例“新开房间”来加以详细分析。其它用例分析与此类似，在此不累赘。根据新开房间用例的交互过程，可画出如图 3.1 所示的新开房间用例的顺序图。

![此处输入图片的描述][12]
					图 3.1 新开房间用例的顺序图

由新开房间顺序图可知，用户首先与新开房间的界面交互，输入新的房间信息，在对请求进行检验后，界面将房间信息交给业务逻辑层的控制器，控制器根据信息的类型转发给业务逻辑层的相应类进行处理，处理完后再将房间信息交给数据访问层的相应类完成对房间信息的创建。


----------


###3.2 KTV分析类机制
分析类到分析机制的映射如表 3.3 所示。
 

> **分析类(analysis classes)**                 分析机制(analysis mechanism)
> **User**             持久化, 安全性
> **UserImpl**       资源管理
> **Food**  		 持久化, 安全性
> **FoodImpl**                                   持久化, 安全性
> **FoodService**                                资源管理
> **FoodServiceImpl**         资源管理
> **UserService**             图形化
> **UserServiceImpl**            持久化, 安全性
> **Vip**  					 持久化, 安全性
> **VipImpl**              持久化, 安全性
> **VipService**            资源管理
> **VipServiceImpl**        资源管理
> **Room**  			 持久化, 安全性
> **RoomImpl**         持久化, 安全性
> **RoomService**      资源管理

	表 3.3 部分分析类到分析机制的映射

###3.3 KTV 的系统类图
在 3.2 的关键抽象的基础上，添加了个实体类的属性，形成图所示的系统类图。
![此处输入图片的描述][13]
图 3.3.1  Food 系统类图
![此处输入图片的描述][14]
图3.3.2  订单系统类图
![此处输入图片的描述][15]
							图3.3.3 会员系统类图 

![此处输入图片的描述][16]
							图3.3.4 房间系统类图
							
							
							
##第四章 子系统设计
###4.1	KTV系统的子系统及接口设计

KTV系统包括两个子系统：房间管理子系统和会员管理子系统。两个子系统向主程序提供接口服务，主程序调用子系统提供的接口完成主要的流程。
![此处输入图片的描述][17]
					图4.1 KTV系统接口设计 

###4.2 KTV的子系统主要流程
系统主要流程包括：打开网页，进入KTV系统界面，打开主界面，主程序获取KTV的房间数据，从左边进入各个功能选项。
图 4.2.1 表示vip用户验证的流程。用户点击主程序的操作界面，主程序向用户管理子系统发出vip信息用户管理界面的请求。
![此处输入图片的描述][18]
图4.2.1vip用户验证流程

图 4.2.2 表示新开房间的流程。用户点击主程序的操作界面，主程序向房间管理子系统发出打开房间管理界面的请求。另外，用户启动主程序后，主程序向房间管理子系统获取该用户的重要房间列表，并分析需要发出提醒的房间，在指定时间发出提醒信息。
![此处输入图片的描述][19]
							图4.2.2 新开房间的流程



###4.3 KTV系统的子系统内部设计
####4.3.1	房间管理子系统设计
房间管理管理子系统遵循总体架构的分层策略，分别分为表示层，业务逻辑层与数据访问层，其中实体包独立于以上三层，包含了所有数据实体类的定义。
1）表示层
由日记窗口和日历控件等组成。
2）业务逻辑层
业务逻辑层负责提供完整的数据流控制服务，对每一个数据实体提供一个管理器类，管理器类负责处理数据的更改和转移，是整个系统的中枢。管理器向上层（表示层）提供调用接口，并调用下层的数据访问服务来完成持久化的操作。NoteManager 负责对日记进行逻辑处理，例如排序等操作，PropertyManager 负责对日记显示的样式等进行管理。
3）数据访问层
数据访问层封装了数据库连接，读取，写入等操作，以提供数据库访问的服务。NoteAccessor 负责对日记进行存取等操作，PropertyAccessor 负责对日记显示的样式等进行存取。
![此处输入图片的描述][20]
					图 4.3.1 房间管理子系统架构

####4.3.2 用户管理子系统设计
根据系统总架构图，用户管理子系统也采用典型的三层架构模式：表示层，业务逻辑层，数据库访问层。
表示层以窗口界面的形式与用户交互，展示用户相关信息，主要有用户提醒，待办事项和记事便签三大界面。其中用户提醒除了提供用户信息一般的添加查看外，还会根据用户提醒设置，在预设的时间，以弹出窗口的形式向用户提示用户。
在与用户交互的过程中，表示层获取用户的相关信息后，以消息的形式传到业务逻辑层的控制器，控制器根据消息的类型，转发到相应的业务逻辑层处理类进行处理。处理完毕后，业务逻辑层处理类根据需要将处理后的消息进一步转发到数据访问层的相应类进行处理。
最后，通过数据访问层完成对信息的增删改持久化处理，以及对信息的查询等。
![此处输入图片的描述][21]
					  图4.3.2 用户管理子系统架构
					  
					  
##第五章 KTV系统运行时架构设计
###5.1 KTV运行时进程分析
在系统设置模块中有三个功能：食品价格管理模块，房间管理模块和用户管理模块。系统在联网多用户的环境下使用，大部分操作都是单线程执行，点餐操作和结账功能需要使用多线程执行。如图 17 所示，系统包括 MainApplication 主进程，RoomApplication 房间管理进程，UserAppliacation 用户管理进程，OrderApplication 订单管理进程等以及提醒和库存不足提醒两个线程。
![此处输入图片的描述][22]
							图5.1 KTV系统运行时架构示意图

接下来将分两个模块，分别以一个详细的进程和实现关系图来说明该模块主要的运行时架构。用户管理模块和房间管理模块都涉及到多线程处理。

###5.2 KTV用户管理模块运行时架构设计
如 图5.2所 示 ，UserApplication 进程对应于UserFrame边界类 的 实现 ， 而RoomManagerment 对应于 OrderManager 的实现，最后 RoomAccess 对应于 OrderAccesser 的实现。由于该部分功能都只是单线程，单用户的环境下使用，并不存在并发等情况，所以运行时架构并不复杂，每个进程跟对应的实现类都是一对一的关系。

![此处输入图片的描述][23]
						图5.2 KTV用户管理模块运行时架构

###5.3 KTV房间管理模块运行时架构设计
RoomManager 线程管理多个 Room 对象，依赖于 RoomManagement进程来获取 Room 对象。而 Room Management 进程对应于 RoomBLImpl 类的实现，Room Access 对应于 RooImpl 类的实现。读取 Agenda 对象的过程只是单线程，单用户的环境下使用，并不存在并发等情况，所以每个进程跟对应的实现类都是一对一的关系。而 Room Remind 线程将会在系统启动后，由 MainApplication 进程来创建，跟其他用户进程并发执行。Room Remind 运行期间，用户修改了 Agenda，日程管理模块会及时通知Room Remind 进行更新。
					![此处输入图片的描述][24]
						图5.3房间管理模块运行时架构
						
						
##第六章 KTV系统数据库设计
###6.1 KTV系统ER图的设计
以下给出由关键抽象的实体及其关联关系形成的 ER 图：
![此处输入图片的描述][25]
图 6.1  KTV数据库关系图

###6.2 KTV数据字典
####6.2.1  定义和缩写
表 6.2.1 定义和缩写

> **P** 					  Primary key，主键
> **U**  				 Unique，唯一性约束或唯一性索引
> **F**  				 Foreign key，外键
> **I**  				 Index，索引
> **C** 			 Cluster，聚簇索引   表6.2.2			 数据表描述

**表名**    **描述**

> **User** 		 用户表，包括帐号和登录密码
> **Note**  		 日记，包括正文，天气，心情等属性
> **Agenda**  	 日程表，记录日程信息
> **Affair**   事务表，记录待办事项的信息
> **Memo**  	 便条表，记录便签内容等信息
> **Contact**   通讯录表，通讯录的信息。
> **Person** 	 联系人表，包括联系人的名称等基本属性
> **Relationship**	 关系表，记录关系的类型，建立时间等
> **Relationship_log** 	 关系日志，记录关系发展过程中的日志信息
> **Important_date**	 重要日期表，记录一些备忘的重要日期的信息。


  [1]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/1.1.png
  [2]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/1.2.png
  [3]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/1.3.png
  [4]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/1.4.png
  [5]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/1.5.png
  [6]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/1.3.1.png
  [7]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/1.3.2.png
  [8]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/1.3.3.png
  [9]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/1.3.4.png
  [10]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/2.1.png
  [11]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/2.2.png
  [12]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/3.1.png
  [13]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/3.1.png
  [14]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/3.3.2.png
  [15]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/3.3.3.png
  [16]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/3.3.4.jpg
  [17]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/4.1.png
  [18]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/4.2.png
  [19]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/4.2.2.png
  [20]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/4.3.1.png
  [21]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/4.3.2.png
  [22]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/5.1.png
  [23]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/5.2.png
  [24]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/5.3.png
  [25]: https://raw.githubusercontent.com/Zero-Group/KTV-System/master/picture/6.1.png